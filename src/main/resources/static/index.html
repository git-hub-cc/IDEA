<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web IDEA</title>

    <!-- 引入 CSS 样式 -->
    <link href="src/css/main.css" rel="stylesheet"/>
    <link href="src/css/components.css" rel="stylesheet"/>
    <!-- ThemeManager 将会动态修改这个 link 的 href -->
    <link href="src/css/theme-dark.css" id="theme-link" rel="stylesheet"/>
    <!-- 引入 Font Awesome (本地化) -->
    <link href="src/js/lib/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet"/>
    <!-- 引入 ansi_up.js 用于将ANSI码转换为HTML -->
    <script src="src/js/lib/ansi_up@5.1.0/ansi_up.min.js">
    </script>
    <!-- Stomp.js 和 SockJS 客户端库 (本地化) -->
    <script src="src/js/lib/libs/sockjs-client/1.6.1/sockjs.min.js">
    </script>
    <script src="src/js/lib/libs/stomp.js/2.3.3/stomp.min.js">
    </script>
    <!-- 引入 Monaco Editor Loader (本地化) -->
    <script src="src/js/lib/libs/monaco-editor/0.46.0/min/vs/loader.min.js">
    </script>
    <script>
        // Monaco Editor 的 AMD Loader 配置
        require.config({ paths: { 'vs': './src/js/lib/ajax/libs/monaco-editor/0.46.0/min/vs' } });
        // 在此处加载 Monaco Editor 的核心模块，确保 CodeEditor 模块能直接使用 window.monaco
        require(['vs/editor/editor.main'], function() {
            console.log('Monaco Editor 核心已加载。');
            // 触发一个自定义事件，通知应用Monaco已准备好
            document.dispatchEvent(new CustomEvent('monaco-ready'));
        });
    </script>
</head>
<body class="dark-theme">

<div id="app-container" class="app-container">
    <div id="toolbar" class="toolbar">
        <div class="toolbar-group">
            <select id="project-selector" class="toolbar-selector" title="选择活动项目">
                <option value="">-- 选择项目 --</option>
            </select>
            <button class="toolbar-btn" data-action="new-file" title="新建文件 (Ctrl+N)">
                <i class="fas fa-file"></i>
            </button>
            <button class="toolbar-btn" data-action="open-folder" title="打开文件夹 (Ctrl+O)">
                <i class="fas fa-folder-open"></i>
            </button>
            <button class="toolbar-btn" data-action="clone-from-url" title="从URL克隆项目">
                <i class="fas fa-cloud-download-alt"></i>
            </button>
            <button class="toolbar-btn" data-action="save-file" title="保存文件 (Ctrl+S)">
                <i class="fas fa-save"></i>
            </button>
        </div>
        <div class="toolbar-group">
            <button class="toolbar-btn" data-action="run-code" title="运行代码 (Shift+F10)">
                <span class="btn-icon-wrapper">
                    <i class="fas fa-play run-icon"></i>      <!-- 运行图标 -->
                    <i class="fas fa-stop stop-icon"></i>     <!-- 停止图标，默认隐藏 -->
                </span>
            </button>
            <button class="toolbar-btn" data-action="debug-code" title="调试代码 (Shift+F9)">
                <i class="fas fa-bug"></i>
            </button>
        </div>
        <div class="toolbar-group">
            <button class="toolbar-btn" data-action="vcs-clone" title="从代码平台选择仓库克隆">
                <i class="fas fa-clone"></i>
            </button>
            <button class="toolbar-btn" data-action="vcs-commit" title="提交更改 (Ctrl+K)">
                <i class="fas fa-code-commit"></i>
            </button>
            <button class="toolbar-btn" data-action="vcs-pull" title="拉取最新 (Ctrl+T)">
                <i class="fas fa-download"></i>
            </button>
            <button class="toolbar-btn" data-action="vcs-push" title="推送更改 (Ctrl+Shift+K)">
                <i class="fas fa-upload"></i>
            </button>
        </div>
        <div class="toolbar-group toolbar-right">
            <button class="toolbar-btn" data-action="settings" title="设置 (Ctrl+,)">
                <i class="fas fa-cog"></i>
            </button>
            <button class="toolbar-btn" data-action="start-tour" title="功能引导">
                <i class="fas fa-question-circle"></i>
            </button>
        </div>
    </div>

    <!-- 主内容区: 结构调整为上下布局 -->
    <div id="main-panels" class="main-panels">
        <!-- 顶部面板的包裹容器，用于水平布局 -->
        <div id="top-panels-wrapper">
            <div id="left-panel" class="panel resizable-panel">
                <div class="panel-header">
                    <h3>项目</h3>
                </div>
                <div id="file-tree" class="file-tree-container">
                </div>
            </div>
            <div id="center-panel" class="panel resizable-panel">
                <div id="editor-tab-bar" class="editor-tab-bar">
                </div>
                <div id="editor-area" class="editor-area">
                    <!-- Monaco 编辑器将挂载到这里 -->
                    <div id="monaco-container" style="width: 100%; height: 100%;"></div>
                    <!-- 媒体预览将在这里显示 -->
                    <div id="media-preview-container" style="width: 100%; height: 100%; display: none;"></div>
                </div>
            </div>
        </div>

        <!-- 底部面板现在是主布局的直接子元素 -->
        <div id="bottom-panel" class="panel resizable-panel">
            <div class="panel-tab-bar">
                <button class="panel-tab active" data-panel-id="console-output">日志</button>
                <button class="panel-tab" data-panel-id="problems-list">问题</button>
                <button class="panel-tab" data-panel-id="terminal-panel">终端</button>
                <button class="panel-tab" data-panel-id="debugger-panel">调试</button>
            </div>
            <div class="panel-content-area">
                <div id="console-output" class="panel-content active">
                    <!-- 这个区域的内容将由 ConsoleManager.js 动态创建以支持虚拟滚动 -->
                </div>
                <div id="problems-list" class="panel-content">
                    <ul><li>无问题</li></ul>
                </div>
                <div id="terminal-panel" class="panel-content">
                    <div id="terminal-output-container">
                        <pre id="terminal-output"></pre>
                    </div>
                    <div class="terminal-input-container">
                        <span class="terminal-prompt">></span>
                        <input type="text" id="terminal-input" autocomplete="off" spellcheck="false"/>
                    </div>
                </div>
                <div id="debugger-panel" class="panel-content">
                    <div class="debugger-controls">
                        <button data-action="step-over" title="步过 (F8)"><i class="fas fa-step-forward"></i></button>
                        <button data-action="step-into" title="步入 (F7)"><i class="fas fa-arrow-right-to-bracket"></i></button>
                        <button data-action="step-out" title="步出 (Shift+F8)"><i class="fas fa-arrow-left"></i></button>
                        <button data-action="resume-debug" title="恢复程序 (F9)"><i class="fas fa-play-circle"></i></button>
                        <button data-action="stop-debug" title="停止调试 (Ctrl+F2)"><i class="fas fa-stop-circle"></i></button>
                    </div>
                    <div class="debugger-info">
                        <div class="debugger-section">
                            <h4>变量</h4>
                            <ul id="debugger-variables"><li>无信息</li></ul>
                        </div>
                        <div class="debugger-section">
                            <h4>调用栈</h4>
                            <ul id="debugger-call-stack"><li>无信息</li></ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="status-bar" class="status-bar">
        <div class="status-left">
            <span>就绪</span>
        </div>
        <div class="status-center">
            <span id="file-info">未选择文件</span>
        </div>
        <div class="status-right">
            <div id="progress-indicator" class="progress-indicator" style="display: none;">
                <span id="progress-label" class="progress-label"></span>
                <div class="progress-track">
                    <div id="progress-bar" class="progress-bar"></div>
                </div>
            </div>
            <span id="cursor-pos">Ln 1, Col 1</span>
            <span id="encoding">UTF-8</span>
            <span id="file-type">Text</span>
            <span id="git-branch"><i class="fas fa-code-branch"></i> master</span>
            <span id="unsaved-indicator" class="unsaved-indicator" title="文件未保存" style="display: none;">●</span>
        </div>
    </div>
</div>
<div id="modal-overlay" class="modal-overlay">
    <div id="common-modal" class="modal">
        <div class="modal-header">
            <h3 id="modal-title"></h3>
            <button class="modal-close-btn" data-action="close-modal">×</button>
        </div>
        <div class="modal-body" id="modal-body">
        </div>
        <div class="modal-footer" id="modal-footer">
            <button class="modal-action-btn primary-btn" data-action="confirm-modal">确认</button>
            <button class="modal-action-btn secondary-btn" data-action="cancel-modal">取消</button>
        </div>
    </div>
</div>
<div id="context-menu" class="context-menu">
</div>

<!-- 会话锁定屏幕遮罩层 -->
<div id="lock-screen-overlay" class="lock-screen-overlay">
    <div class="lock-screen-content">
        <div class="lock-screen-icon">
            <i class="fas fa-user-lock"></i>
        </div>
        <h1>应用正在使用中</h1>
        <p>当前有其他用户正在使用此 Web IDE。请稍后...</p>
        <p class="lock-screen-timer">我们将在 <span id="lock-screen-countdown">5</span> 秒后自动重试。</p>
        <div class="spinner"></div>
    </div>
</div>

<!-- ========================= 关键优化 START ========================= -->
<!-- 繁忙状态遮罩层，用于在耗时操作期间显示等待光标 -->
<div id="busy-overlay" class="busy-overlay"></div>
<!-- ========================= 关键优化 END =========================== -->

<!-- 唯一的应用入口点 -->
<script type="module" src="src/js/main.js"></script>

</body>
</html>